<!DOCTYPE html>
<html lang="en">
<html class="dark light">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    

    
    
    
    <title>
         Practicing Golang (Part 2)
        
    </title>

        
            <meta property="og:title" content="Practicing Golang (Part 2)" />
        
     

     
         
             <meta property="og:description" content="Ed On Code is a blog about software development and related topics." />
         
     

     
         
             <meta name="description" content="Ed On Code is a blog about software development and related topics." />
         
    

    
    

    
    
        <link href=https://edoncode.dev/fonts.css rel="stylesheet" />
    

    
    

    
    

    
    
    
    
    

    

    
    <link rel="alternate" type="application/atom+xml" title="Ed On Code" href="https://edoncode.dev/atom.xml">


    
    
        <link rel="stylesheet" type="text/css" href=https://edoncode.dev/theme/light.css />
        <link id="darkModeStyle" rel="stylesheet" type="text/css" href="https://edoncode.dev/theme/dark.css" />
    

    <!-- Set the correct theme in the script -->
    <script src=https://edoncode.dev/js/themetoggle.js></script>
    
        <script>setTheme(getSavedTheme());</script>
    

    <link rel="stylesheet" type="text/css" media="screen" href=https://edoncode.dev/main.css />

    
</head>


<body>
    <div class="content">
        <header>
    <div class="main">
        <a href=https:&#x2F;&#x2F;edoncode.dev>Ed On Code</a>

        <div class="socials">
            
        </div>
    </div>

    <nav>
        

        
        |<a id="dark-mode-toggle" onclick="toggleTheme(); event.preventDefault();" href="#">
            <img src=https://edoncode.dev/feather/sun.svg id="sun-icon" style="filter: invert(1);" alt="Light" />
            <img src=https://edoncode.dev/feather/moon.svg id="moon-icon" alt="Dark" />
        </a>

        <!-- Inititialize the theme toggle icons -->
        <script>updateItemToggleTheme()</script>
        
    </nav>
</header>


        
        
    
<main>
    <article>
        <div class="title">
            
            
    <div class="page-header">
        Practicing Golang (Part 2)<span class="primary-color" style="font-size: 1.6em">.</span>
    </div>


                <div class="meta">
                    
                        Posted on <time>2015-10-13</time>
                    

                    

                    

                    
                    

                    
                    

                    

                </div>
        </div>

        

        
        

        <section class="body">
            <h2 id="Channels_and_Routines">Channels and Routines</h2>
<p>The time has come to discuss one of the main features of the Go language: concurrency. Undoubtedly, one of the most exciting aspects of Go is that concurrency is ingrained in the language’s core. It does not require auxiliary libraries, workarounds, or makeshift solutions.</p>
<p>The key components responsible for Go’s concurrency model are the go keyword, channels, and goroutines. The go keyword initiates a function as a goroutine, allowing it to run independently alongside the main thread until it completes. Channels facilitate communication between goroutines by providing a synchronized way to send and receive values. When a value is sent to a channel (similar to a pipe), it is only received if the channel is ready to accept it, ensuring synchronization and preventing race conditions between connected functions.</p>
<p>Additionally, Go supports buffered channels, which allow for more flexible communication patterns by enabling channels to hold a specified number of values without immediate receipt. Understanding these concurrency mechanisms is essential for building efficient and scalable applications in Go. For more information, visit the Go Concurrency Tour.</p>
<pre data-lang="go" style="background-color:#2b303b;color:#c0c5ce;" class="language-go "><code class="language-go" data-lang="go"><span style="color:#b48ead;">func </span><span style="color:#8fa1b3;">pool</span><span>() </span><span style="color:#b48ead;">chan string </span><span>{
</span><span>	</span><span style="color:#bf616a;">ch </span><span>:= </span><span style="color:#96b5b4;">make</span><span>(</span><span style="color:#b48ead;">chan string</span><span>)
</span><span>	</span><span style="color:#b48ead;">go func</span><span>() {
</span><span>		</span><span style="color:#bf616a;">haveResponse </span><span>:= </span><span style="color:#d08770;">false
</span><span>		</span><span style="color:#bf616a;">requestJSON </span><span>:= </span><span style="color:#b48ead;">func</span><span>() {
</span><span>			</span><span style="color:#b48ead;">if </span><span style="color:#bf616a;">res</span><span>, </span><span style="color:#bf616a;">err </span><span>:= </span><span style="color:#bf616a;">checker</span><span>(); </span><span style="color:#bf616a;">err </span><span>== </span><span style="color:#d08770;">nil </span><span>{
</span><span>				</span><span style="color:#b48ead;">if </span><span style="color:#bf616a;">jsonRes </span><span>:= </span><span style="color:#bf616a;">parseJSON</span><span>(</span><span style="color:#bf616a;">res</span><span>); </span><span style="color:#bf616a;">jsonRes </span><span>!= &quot;&quot; {
</span><span>					</span><span style="color:#bf616a;">haveResponse </span><span>= </span><span style="color:#d08770;">true
</span><span>					</span><span style="color:#bf616a;">ch </span><span>&lt;- </span><span style="color:#bf616a;">jsonRes
</span><span>				}
</span><span>			}
</span><span>		}
</span><span>
</span><span>		</span><span style="color:#b48ead;">for </span><span>{
</span><span>			</span><span style="color:#bf616a;">requestJSON</span><span>()
</span><span>			</span><span style="color:#b48ead;">if </span><span style="color:#bf616a;">haveResponse </span><span>{
</span><span>				</span><span style="color:#b48ead;">break
</span><span>			} </span><span style="color:#b48ead;">else </span><span>{
</span><span>				</span><span style="color:#bf616a;">log</span><span>.</span><span style="color:#bf616a;">Println</span><span>(&quot;</span><span style="color:#a3be8c;">No result try again ...</span><span>&quot;)
</span><span>			}
</span><span>		}
</span><span>
</span><span>		</span><span style="color:#bf616a;">c </span><span>:= </span><span style="color:#bf616a;">time</span><span>.</span><span style="color:#bf616a;">Tick</span><span>(</span><span style="color:#d08770;">5 </span><span>* </span><span style="color:#bf616a;">time</span><span>.</span><span style="color:#bf616a;">Minute</span><span>)
</span><span>		</span><span style="color:#b48ead;">for </span><span style="color:#bf616a;">now </span><span>:= </span><span style="color:#b48ead;">range </span><span style="color:#bf616a;">c </span><span>{
</span><span>			</span><span style="color:#bf616a;">log</span><span>.</span><span style="color:#bf616a;">Println</span><span>(&quot;</span><span style="color:#a3be8c;">Updated at </span><span style="color:#d08770;">%v</span><span>&quot;, </span><span style="color:#bf616a;">now</span><span>)
</span><span>			</span><span style="color:#bf616a;">requestJSON</span><span>()
</span><span>		}
</span><span>	}()
</span><span>	</span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">ch
</span><span>}
</span></code></pre>
<p>When executed, the pool function creates a string channel used for communication with the goroutine initiated on line 3. The presence of the go keyword ensures that the anonymous function runs in the background. On line 5, we define and assign an anonymous function to a variable, which calls the checker and parseJSON functions on line 9 to insert the USD result into the communication channel. The loop on line 14 terminates once a value is received from the channel, addressing scenarios where a request to Yahoo! might not return a USD value by ensuring a value is present from the outset.</p>
<p>Furthermore, on line 24, an infinite loop is established to execute every five minutes, utilizing the time.Tick function to trigger the loop with the necessary pauses.</p>
<h2 id="Main_function">Main function</h2>
<p>Like its C language predecessor, the main function is also called main.</p>
<pre data-lang="go" style="background-color:#2b303b;color:#c0c5ce;" class="language-go "><code class="language-go" data-lang="go"><span style="color:#b48ead;">func </span><span style="color:#8fa1b3;">main</span><span>() {
</span><span>	</span><span style="color:#65737e;">// Get the first value
</span><span>	</span><span style="color:#bf616a;">checkerpool </span><span>:= </span><span style="color:#bf616a;">pool</span><span>()
</span><span>	</span><span style="color:#bf616a;">latestResult </span><span>:= &lt;-</span><span style="color:#bf616a;">checkerpool
</span><span>
</span><span>	</span><span style="color:#65737e;">// To deploy at heroku :D
</span><span>	</span><span style="color:#bf616a;">env </span><span>:= </span><span style="color:#bf616a;">os</span><span>.</span><span style="color:#bf616a;">Getenv</span><span>(&quot;</span><span style="color:#a3be8c;">GO_ENV</span><span>&quot;)
</span><span>	</span><span style="color:#bf616a;">host </span><span>:= &quot;</span><span style="color:#a3be8c;">127.0.0.1</span><span>&quot;
</span><span>	</span><span style="color:#bf616a;">port </span><span>:= </span><span style="color:#d08770;">9000
</span><span>	</span><span style="color:#65737e;">//token := &quot;&quot;
</span><span>
</span><span>	</span><span style="color:#b48ead;">if </span><span style="color:#bf616a;">env </span><span>== &quot;</span><span style="color:#a3be8c;">PRODUCTION</span><span>&quot; {
</span><span>		</span><span style="color:#bf616a;">host </span><span>= &quot;&quot;
</span><span>		</span><span style="color:#bf616a;">port</span><span>, </span><span style="color:#bf616a;">_ </span><span>= </span><span style="color:#bf616a;">strconv</span><span>.</span><span style="color:#bf616a;">Atoi</span><span>(</span><span style="color:#bf616a;">os</span><span>.</span><span style="color:#bf616a;">Getenv</span><span>(&quot;</span><span style="color:#a3be8c;">PORT</span><span>&quot;))
</span><span>		</span><span style="color:#65737e;">//token = os.Getenv(&quot;TOKEN&quot;)
</span><span>	}
</span><span>
</span><span>	</span><span style="color:#bf616a;">address </span><span>:= </span><span style="color:#bf616a;">fmt</span><span>.</span><span style="color:#bf616a;">Sprintf</span><span>(&quot;</span><span style="color:#d08770;">%s</span><span style="color:#a3be8c;">:</span><span style="color:#d08770;">%d</span><span>&quot;, </span><span style="color:#bf616a;">host</span><span>, </span><span style="color:#bf616a;">port</span><span>)
</span><span>	</span><span style="color:#bf616a;">log</span><span>.</span><span style="color:#bf616a;">Println</span><span>(&quot;</span><span style="color:#a3be8c;">Ready to serve at</span><span>&quot;, </span><span style="color:#bf616a;">address</span><span>)
</span><span>
</span><span>	</span><span style="color:#bf616a;">http</span><span>.</span><span style="color:#bf616a;">HandleFunc</span><span>(&quot;</span><span style="color:#a3be8c;">/</span><span>&quot;, </span><span style="color:#b48ead;">func</span><span>(</span><span style="color:#bf616a;">rw http</span><span>.</span><span style="color:#b48ead;">ResponseWriter</span><span>, </span><span style="color:#bf616a;">req </span><span>*</span><span style="color:#bf616a;">http</span><span>.</span><span style="color:#b48ead;">Request</span><span>) {
</span><span>		</span><span style="color:#b48ead;">select </span><span>{
</span><span>		</span><span style="color:#b48ead;">case </span><span style="color:#bf616a;">latestResult </span><span>:= &lt;-</span><span style="color:#bf616a;">checkerpool</span><span>:
</span><span>			</span><span style="color:#bf616a;">log</span><span>.</span><span style="color:#bf616a;">Println</span><span>(&quot;</span><span style="color:#a3be8c;">Get result</span><span>&quot;, </span><span style="color:#bf616a;">latestResult</span><span>)
</span><span>		</span><span style="color:#b48ead;">default</span><span>:
</span><span>			</span><span style="color:#bf616a;">log</span><span>.</span><span style="color:#bf616a;">Println</span><span>(&quot;</span><span style="color:#a3be8c;">Get cache value</span><span>&quot;)
</span><span>		}
</span><span>
</span><span>		</span><span style="color:#bf616a;">_</span><span>, </span><span style="color:#bf616a;">err </span><span>:= </span><span style="color:#bf616a;">rw</span><span>.</span><span style="color:#bf616a;">Write</span><span>([]</span><span style="color:#b48ead;">byte</span><span>(</span><span style="color:#bf616a;">latestResult</span><span>))
</span><span>
</span><span>		</span><span style="color:#b48ead;">if </span><span style="color:#bf616a;">err </span><span>!= </span><span style="color:#d08770;">nil </span><span>{
</span><span>			</span><span style="color:#bf616a;">log</span><span>.</span><span style="color:#bf616a;">Println</span><span>(</span><span style="color:#bf616a;">err</span><span>)
</span><span>		}
</span><span>	})
</span><span>
</span><span>	</span><span style="color:#b48ead;">if </span><span style="color:#bf616a;">err </span><span>:= </span><span style="color:#bf616a;">http</span><span>.</span><span style="color:#bf616a;">ListenAndServe</span><span>(</span><span style="color:#bf616a;">address</span><span>, </span><span style="color:#d08770;">nil</span><span>); </span><span style="color:#bf616a;">err </span><span>!= </span><span style="color:#d08770;">nil </span><span>{
</span><span>		</span><span style="color:#bf616a;">log</span><span>.</span><span style="color:#bf616a;">Fatal</span><span>(&quot;</span><span style="color:#a3be8c;">Failed to serve to address</span><span>&quot;, </span><span style="color:#bf616a;">address</span><span>, </span><span style="color:#bf616a;">err</span><span>)
</span><span>	}
</span><span>}
</span></code></pre>
<p>Finally, we reach the concluding steps of our implementation. On line 3, we create a pool using the pool function, which returns a channel. On line 4, the value from this channel is retrieved and stored in the latestResult variable, which, as its name suggests, holds the most recent result. Up to line 19, various initialization routines are performed, including setting variables, checking the environment, and, if necessary, changing the HTTP port (which is essential when deploying to platforms like Heroku). On line 21, a handler is created for the root route “/” and assigned to a function designed to handle HTTP requests.</p>
<p>At this point, on line 22, the select statement is used to check if a value was successfully retrieved from the channel. If a value is present, the corresponding execution path is followed; otherwise, the default case is executed if the channel is empty. Finally, the latestResult value is written to the HTTP response, ensuring that the requesting user receives the most recent USD value.</p>

        </section>
    </article>
</main>



        
            
        

        
    </div>
</body>

</html>
